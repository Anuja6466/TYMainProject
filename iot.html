<!DOCTYPE html>
<html>
<head>
    <title>ClimatXPro IoT Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>ClimatXPro IoT Dashboard</h1>
    <div id="temp">Temperature: -- °C</div>
    <div id="hum">Humidity: -- %</div>
    <div id="graph"></div>

    <script>
        let tempData = [];
        let humData = [];
        let timeData = [];

        function fetchData() {
            fetch('/api/latest')
                .then(response => response.json())
                .then(data => {
                    const now = new Date().toLocaleTimeString();
                    tempData.push(data.temperature);
                    humData.push(data.humidity);
                    timeData.push(now);

                    document.getElementById('temp').innerText = "Temperature: " + data.temperature + " °C";
                    document.getElementById('hum').innerText = "Humidity: " + data.humidity + " %";

                    const trace1 = { x: timeData, y: tempData, name: 'Temperature', mode: 'lines+markers' };
                    const trace2 = { x: timeData, y: humData, name: 'Humidity', mode: 'lines+markers' };

                    Plotly.newPlot('graph', [trace1, trace2]);
                });
        }

        setInterval(fetchData, 5000); // fetch every 5 seconds
        fetchData();
    </script>
</body>
</html>

